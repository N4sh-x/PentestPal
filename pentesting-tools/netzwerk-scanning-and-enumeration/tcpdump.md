# TCPDUMP

**Was ist Tcpdump?**\
Tcpdump ist ein Kommandozeilenwerkzeug zur Analyse von Netzwerkverkehr. Es bietet die Möglichkeit, Pakete direkt von einer Netzwerkschnittstelle oder aus einer Datei zu erfassen und auszuwerten. Das Tool ist besonders auf Unix-ähnlichen Systemen weit verbreitet und wird oft eingesetzt, um Netzwerkprobleme zu diagnostizieren, den Netzwerkverkehr zu untersuchen und Sicherheitsanalysen durchzuführen.

**Warum Tcpdump nutzen?**

1. **Einfache und flexible Analyse**: Tcpdump bietet eine detaillierte Ansicht des Datenverkehrs, inklusive Protokolle, IP-Adressen, Ports, Flags und mehr. Das macht es ideal, um Probleme zu lokalisieren, z. B. fehlerhafte Verbindungen oder verdächtigen Traffic.
2. **Ohne GUI verfügbar**: Tcpdump benötigt keine grafische Oberfläche, was es besonders praktisch für den Einsatz über Remote-Verbindungen (wie SSH) macht.
3. **Direkter Zugriff auf das Netzwerk**: Tcpdump verwendet die Bibliotheken `pcap` und `libpcap`, um auf die Netzwerkschnittstelle im Promiscuous Mode zuzugreifen. Dadurch können alle Pakete im Netzwerksegment analysiert werden – nicht nur die, die für den eigenen Host bestimmt sind.

**Wo wird Tcpdump verwendet?**\
Tcpdump ist auf den meisten Unix- und Linux-Derivaten verfügbar und wird oft von Administratoren, Sicherheitsexperten und Pentestern verwendet:

* **Netzwerkadministratoren**: Analyse von Netzwerkproblemen.
* **Sicherheitsexperten**: Untersuchung von Sicherheitsvorfällen.
* **Pentester**: Überwachung des Netzwerkverkehrs während Tests.

#### Grundlegende Nutzung von Tcpdump

**Verfügbare Schnittstellen identifizieren**\
Bevor man den Netzwerkverkehr mitschneidet, ist es notwendig, die vorhandenen Schnittstellen zu kennen:

```bash
$ sudo tcpdump -D
1.eth0 [Up, Running, Connected]
2.any (Pseudo-device that captures on all interfaces) [Up, Running]
3.lo [Up, Running, Loopback]
4.bluetooth0 (Bluetooth adapter number 0) [Wireless, Association status unknown]
5.bluetooth-monitor (Bluetooth Linux Monitor) [Wireless]
```

Die Ausgabe zeigt alle Netzwerkschnittstellen, die das System bietet. Jede Schnittstelle kann unterschiedliche Teile des Netzwerkverkehrs darstellen, z.B. Ethernet (`eth0`), Loopback (`lo`) oder WLAN (`wlan0`).

**Pakete auf einer spezifischen Schnittstelle mitschneiden**\
Nachdem die richtige Schnittstelle identifiziert wurde, kann der Netzwerkverkehr darauf belauscht werden:

```bash
$ sudo tcpdump -i eth0
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
11:58:33.719241 IP 192.168.1.5.55260 > 172.67.1.1.https: Flags [P.], seq 1953742992:1953743073, ack 2034210498, win 501, length 81
11:58:33.747853 IP 172.67.1.1.https > 192.168.1.5.55260: Flags [.], ack 81, win 158, length 0
```

Dieser Befehl startet das Mitschneiden des Verkehrs auf `eth0` und zeigt alle Pakete, die über diese Schnittstelle laufen. Die Ausgabe enthält die IP-Adressen, Ports und grundlegende Protokolldetails.

**Namensauflösung deaktivieren**\
Der Switch `-nn` unterdrückt die Auflösung von IP-Adressen und Portnummern:

```bash
$ sudo tcpdump -i eth0 -nn
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
12:02:35.580449 IP 192.168.1.5.48402 > 52.31.199.148.443: Flags [P.], seq 988167196:988167233, ack 1512376150, win 501, options [nop,nop,TS val 214282239 ecr 77421665], length 37
```

Die Ausgabe zeigt rohe IP-Adressen und Portnummern an, was die Analyse einfacher macht.

**Ethernet-Header anzeigen**\
Mit der Option `-e` kann Tcpdump den Ethernet-Header anzeigen:

```bash
$ sudo tcpdump -i eth0 -e
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
12:05:45.982115 00:0c:29:97:52:65 (oui Unknown) > 8a:66:5a:11:8d:64 (oui Unknown), ethertype IPv4 (0x0800), length 103: 192.168.1.5.57142 > ec2-99-80-22-207.eu-west-1.compute.amazonaws.com.https: Flags [P.], seq 922951468:922951505, ack 1842875143, win 501
```

Dies ist hilfreich, um die Quell- und Ziel-MAC-Adressen zu untersuchen.

**Paketinhalt in Hex und ASCII anzeigen**\
Mit `-X` wird der gesamte Paketinhalt sowohl in Hexadezimal- als auch ASCII-Format dargestellt:

```bash
$ sudo tcpdump -i eth0 -X
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
12:10:34.972248 IP 192.168.1.5.57170 > ec2-99-80-22-207.eu-west-1.compute.amazonaws.com.https: Flags [P.], seq 2612172989:2612173026, ack 3165195759, win 501, options [nop,nop,TS val 1368561052 ecr 65712142], length 37
    0x0000:  4500 0059 4352 4000 4006 3f1b ac10 9202  E..YCR@.@.?.....
    0x0010:  6350 16cf df52 01bb 9bb2 98bd bca9 0def  cP...R..........
    0x0020:  8018 01f5 b87d 0000 0101 080a 5192 959c  .....}......Q...
```

Dies ermöglicht eine detaillierte Analyse des Paketinhalts.

**Ergebnisse in einer Datei speichern**\
Um den aufgezeichneten Netzwerkverkehr zur späteren Analyse zu speichern:

```bash
$ sudo tcpdump -i eth0 -w ~/output.pcap
tcpdump: listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
10 packets captured
131 packets received by filter
0 packets dropped by kernel
```

Die Ausgabe wird in der Datei `output.pcap` gespeichert, die mit Tools wie Wireshark weiter analysiert werden kann.

**Aus einer Datei lesen**\
Um die gespeicherten Daten zu analysieren, können wir die `-r`-Option verwenden:

```bash
$ sudo tcpdump -r ~/output.pcap
reading from file /home/user/output.pcap, link-type EN10MB (Ethernet), snapshot length 262144
12:15:40.321509 IP 192.168.1.5.57236 > ec2-99-80-22-207.eu-west-1.compute.amazonaws.com.https: Flags [P.], seq 2751910362:2751910399, ack 946558143, win 501, options [nop,nop,TS val 1368866401 ecr 65790024], length 37
```

Die gespeicherten Pakete werden angezeigt, wobei wir zusätzliche Optionen wie `-v` oder `-X` nutzen können, um detaillierte Informationen zu erhalten.

#### Warum Tcpdump effizient nutzen?

**Erkennung und Debugging**\
Tcpdump bietet detaillierte Einblicke in jedes Paket, das über die Netzwerkschnittstelle läuft. Dies hilft, Netzwerkprobleme zu diagnostizieren, z. B. Verbindungsabbrüche oder Paketverluste.

**Sicherheitsanalyse**\
Im Bereich der Netzwerksicherheit ist Tcpdump ein wertvolles Tool. Es ermöglicht die Identifizierung verdächtiger Aktivitäten, wie z.B. ungewöhnlich viele Verbindungen von einer IP-Adresse oder Muster, die auf Angriffe hinweisen könnten.

Tcpdump ist somit ein sehr mächtiges Werkzeug in der Analyse und Sicherheit von Netzwerken – besonders, wenn man weiß, wie man die zahlreichen Optionen effizient einsetzt, um genau die benötigten Informationen aus einem oft sehr großen Datenstrom zu filtern.
