# 21 - FTP

### FTP – File Transfer Protocol

FTP (File Transfer Protocol) ist ein Protokoll, das in der Anwendungsschicht des TCP/IP-Stapels arbeitet. Es wird verwendet, um Dateien zwischen einem Client und einem Server zu übertragen, wobei zwei Kanäle genutzt werden: der **Kontrollkanal** (TCP-Port 21) und der **Datenkanal** (TCP-Port 20). FTP kann entweder im **aktiven** oder **passiven Modus** betrieben werden, abhängig davon, ob der Client oder der Server die Datenübertragung initiiert.

#### Sicherheitsprobleme

FTP überträgt Daten im Klartext, was es anfällig für **Sniffing** und **Man-in-the-Middle-Angriffe** macht. Eine Möglichkeit, dies zu umgehen, ist der Einsatz von **FTPS** (FTP über SSL/TLS) oder **SFTP** (FTP über SSH).

Ein weiteres Problem ist der **anonyme FTP-Zugang**, der oft für öffentliche FTP-Server verwendet wird. Dies erlaubt es jedem, Dateien ohne Authentifizierung hoch- oder herunterzuladen, was Sicherheitsrisiken birgt.

***

### Footprinting und Pentesting eines FTP-Servers

#### 1. Nmap-Scans

Um Informationen über den FTP-Server zu sammeln, können wir Nmap verwenden. Dieser Scan liefert Details zur Version und erlaubt es, Sicherheitslücken zu identifizieren.

```bash
sudo nmap -sV -p21 -sC -A <Ziel-IP>
```

Beispielausgabe:

```plaintext
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
```

Hier sehen wir, dass anonymer Zugang erlaubt ist. Dies kann weiter untersucht werden.

#### 2. Anonymer Zugang

Verbinde dich mit dem FTP-Server und teste, ob du ohne Authentifizierung Dateien herunterladen oder hochladen kannst:

```bash
ftp <Ziel-IP>
Name: anonymous
Password: <leeres Passwort>

ftp> ls
ftp> get <Dateiname>
```

#### 3. Alle Dateien herunterladen

Mit **wget** kannst du alle verfügbaren Dateien von einem anonymen FTP-Server herunterladen:

```bash
wget -m --no-passive ftp://anonymous:anonymous@<Ziel-IP>
```

***

### Schwachstellen und Exploits

#### vsFTPd-Backdoor

Eine ältere Version von **vsFTPd** (v2.3.4) hat eine bekannte Backdoor, die für Remote Code Execution (RCE) genutzt werden kann. Mit Nmap kann diese Schwachstelle geprüft werden:

```bash
bashCode kopierensudo nmap --script ftp-vsftpd-backdoor -p 21 <Ziel-IP>
```

#### Weitere Nmap-Skripte

*   **ftp-anon**: Prüft, ob der Server anonymen Zugang erlaubt:

    ```bash
    sudo nmap --script ftp-anon <Ziel-IP>
    ```
*   **ftp-brute**: Führt Brute-Force-Angriffe auf FTP-Login durch:

    ```bash
    sudo nmap --script ftp-brute -p 21 <Ziel-IP>
    ```

#### 4. Hochladen von Dateien

Falls der Server das Hochladen von Dateien erlaubt, kannst du eine Datei hochladen und sehen, ob der Upload erfolgreich war:

```bash
ftp> put testupload.txt
```

Wenn du schädliche Dateien (z. B. eine PHP-Shell) hochladen kannst, kann dies zu einer **Remote Code Execution (RCE)** führen, insbesondere wenn der FTP-Server mit einem Webserver verbunden ist.

***

### Fortgeschrittene Angriffe

#### SSL/TLS-Verbindungen testen

Wenn der Server SSL/TLS verwendet, kann man mit **openssl** die Zertifikate überprüfen und mehr über den Server herausfinden:

```bash
openssl s_client -connect <Ziel-IP>:21 -starttls ftp
```

***

### Zusammenfassung

* **Nmap** und **NSE-Skripte** helfen beim Erkennen von Schwachstellen.
* **Anonymer Zugang** und **unsichere Konfigurationen** sind häufige Sicherheitslücken.
* **Datei-Uploads** können ausgenutzt werden, um Shells zu platzieren und Remote Code Execution durchzuführen.
