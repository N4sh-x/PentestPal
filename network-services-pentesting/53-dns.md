# 53 - DNS

### DNS Footprinting und Konfigurationen

#### Wichtige DNS-Records

DNS-Records sind Einträge, die Informationen über die Beziehung zwischen Domainnamen und IP-Adressen enthalten. Hier sind die wichtigsten:

| Record    | Beschreibung                                                                   |
| --------- | ------------------------------------------------------------------------------ |
| **A**     | Gibt die IPv4-Adresse der Domain zurück.                                       |
| **AAAA**  | Gibt die IPv6-Adresse der Domain zurück.                                       |
| **MX**    | Mail Exchange: Zeigt den zuständigen Mailserver für die Domain.                |
| **NS**    | Gibt die Nameserver der Domain zurück.                                         |
| **TXT**   | Enthält beliebige Textinformationen, z.B. SPF und DMARC für E-Mail-Sicherheit. |
| **CNAME** | Canonical Name: Alias für einen anderen Domainnamen.                           |
| **PTR**   | Reverse Lookup: Konvertiert IP-Adressen in Domainnamen.                        |
| **SOA**   | Start of Authority: Informationen über die DNS-Zone und den Administrator.     |

***

#### `named.conf.local`, `named.conf.options`, `named.conf.log` (Bind9 Konfiguration)

Bind9 ist der am häufigsten verwendete DNS-Server auf Linux-Systemen. Die Konfigurationsdateien sind in Abschnitte unterteilt, um den DNS-Dienst flexibel zu verwalten.

*   **`named.conf.local`**: Definiert die DNS-Zonen und erlaubt lokale Konfigurationen. Beispiel:

    ```bash
    $ cat /etc/bind/named.conf.local

    zone "domain.com" {
        type master;
        file "/etc/bind/db.domain.com";
        allow-update { key rndc-key; };
    };
    ```
*   **`named.conf.options`**: Beinhaltet globale Optionen, die für alle Zonen gelten, z.B. DNS-Caching, Weiterleitungen.

    ```bash
    $ cat /etc/bind/named.conf.options

    options {
        directory "/var/cache/bind";
        allow-query { any; };   # Ermöglicht Anfragen von allen Hosts
        recursion no;           # Verhindert rekursive Anfragen
    };
    ```
*   **`named.conf.log`**: Enthält Logging-Einstellungen für DNS-Anfragen, Fehler und Ereignisse.

    ```bash
    logging {
        channel default_log {
            file "/var/log/named/default.log" versions 3 size 5m;
            severity dynamic;
            print-time yes;
        };

        category default { default_log; };
    };
    ```

***

#### Gefährliche Einstellungen (Dangerous Settings)

Unsichere Einstellungen können ein DNS-Server angreifbar machen. Einige Beispiele für riskante Konfigurationen:

| Option              | Beschreibung                                                                                                                             |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| **allow-query**     | Definiert, welche Hosts Anfragen an den DNS-Server senden dürfen.                                                                        |
| **allow-recursion** | Ermöglicht rekursive Anfragen, die bei falscher Konfiguration missbraucht werden können.                                                 |
| **allow-transfer**  | Erlaubt Zonentransfers (AXFR). Wenn dies nicht auf vertrauenswürdige Hosts eingeschränkt ist, können Angreifer die gesamte Zone abrufen. |

**Beispiel** einer riskanten Konfiguration, die erlaubt, dass jeder Zonentransfers durchführen kann:

```bash
zone "domain.com" {
    type master;
    file "/etc/bind/db.domain.com";
    allow-transfer { any; };  # Riskant! Jeder kann die Zone übertragen.
};
```

***

#### Footprinting des Dienstes (Footprinting the Service)

Beim DNS-Footprinting geht es darum, Informationen über die DNS-Infrastruktur eines Ziels zu sammeln. Hier einige Techniken mit `dig`, `dnsenum`, `host` und `gobuster`.

**1. `dig` (DNS Query)**

*   **NS-Abfrage**: Fragt die Nameserver einer Domain ab.

    ```bash
    $ dig ns example.com
    ;; ANSWER SECTION:
    example.com.   172800 IN NS ns1.example.com.
    ```
*   **ANY-Abfrage**: Zeigt alle verfügbaren DNS-Records (sofern der Server es erlaubt).

    ```bash
    $ dig any example.com
    ```
*   **Version des DNS-Servers abfragen**: Abfragen der DNS-Server-Version (CHAOS query):

    ```bash
    $ dig CH TXT version.bind @dns.example.com
    ```

**2. Zonentransfer (AXFR)**

Zonentransfer (AXFR) erlaubt es, eine vollständige Kopie der DNS-Zone zu erhalten, wenn der Server nicht richtig konfiguriert ist:

```bash
$ dig axfr example.com @ns1.example.com
```

**3. Subdomain-Bruteforcing mit `gobuster`**

Um Subdomains zu finden, kann `gobuster` eine Wortliste gegen den DNS-Server verwenden:

*   **Beispiel für Bruteforce von Subdomains mit `gobuster`:**

    ```bash
    $ gobuster dns -d example.com -w /path/to/subdomains.txt -i
    ```

    Dieser Befehl versucht, Subdomains zu finden, indem er die `subdomains.txt` Liste durchläuft und die gefundenen Einträge anzeigt.

**4. `dnsenum` für umfassende DNS-Reconnaissance**

`dnsenum` ist ein Tool, das Zonentransfer, Subdomain-Bruteforcing und DNS-Abfragen kombiniert:

*   **Beispiel:**

    ```bash
    $ dnsenum --dnsserver 8.8.8.8 --enum example.com
    ```

Dieses Tool zeigt Nameserver, Mailserver und führt Subdomain-Bruteforcing durch.

**5. Bruteforcing von Subdomains mit `nmap`**

`nmap` bietet spezielle Skripte, um Subdomains zu bruteforcen:

*   **Subdomain-Bruteforcing mit `nmap`:**

    ```bash
    $ nmap --script dns-brute example.com
    ```

Dieses Skript durchläuft eine Liste von möglichen Subdomains und zeigt gefundene Einträge an.

***

#### Zusammenfassung der Tools und Techniken:

<table><thead><tr><th width="150">Tool</th><th width="262">Verwendung</th><th>Beispielbefehl</th></tr></thead><tbody><tr><td><strong><code>dig</code></strong></td><td>DNS-Abfragen, Zonentransfer, Version abfragen</td><td><code>$ dig any example.com</code></td></tr><tr><td><strong><code>dnsenum</code></strong></td><td>Automatische DNS-Enumeration, Subdomains</td><td><code>$ dnsenum --enum example.com</code></td></tr><tr><td><strong><code>gobuster</code></strong></td><td>Subdomain-Bruteforcing</td><td><code>$ gobuster dns -d example.com -w subdomains.txt</code></td></tr><tr><td><strong><code>nmap</code></strong></td><td>Subdomain-Bruteforcing, Zonentransfer</td><td><code>$ nmap --script dns-brute example.com</code></td></tr><tr><td><strong><code>host</code></strong></td><td>Schnelle DNS-Abfragen</td><td><code>$ host -t ns example.com</code></td></tr></tbody></table>
